# [Working with R, II]{.lightblue} {.unnumbered}
{{< include macros.qmd >}}

R has a wide range of basic plotting functions, and in addition to them there are many plotting libraries. Here we shall see examples of how to create the kinds of plot discussed in [chapter @sec-prob-distribs], using basic R functions and custom functions used in these notes.

```{r}
#| echo: false
knitr::opts_knit$set(root.dir = "code/")
```

## Plotting pairs of values in R {#sec-R-plotting-pair}

A very simple kind of plot is the one where we plot a sequence of values against another sequence *of the same length*, interpreting the first as x-axis and the second as y-axis. This can be done with the base R function [`plot()`](https://stat.ethz.ch/R-manual/R-patched/library/base/html/plot.html). Here we consider sequences `a` and `b`, with six values each:

```{r}
a <- c(1, 2, 3, 4, 5, 6)
b <- c(0.05, 0.3, 0.4, 0.2, 0.03, 0.02)

plot(x = a, y = b)
```

You notice that the names of the variables appear automatically on the axes, and the pairs of points are represented by small, empty circles. If we want to join the points with `l`ines we can use the `type = 'l'` argument; with `type = 'b'` we get both circles and lines. The `l`ine `w`i`d`th is controlled by the `lwd =` argument, and the `l`ine `ty`pe (solid, dashed, dotted, and so on) by the `lty =` argument. The colour by `col =`. We can also change the axes' labels with `xlab =` and `ylab =`, and the ranges of the two axes with `xlim =` and `ylim =`. Let's see two examples:

```{r}

plot(x = a, y = b,
    type = 'l',
    lwd = 1, lty = 1, col = 1,
    xlab = 'quantity A', ylab = 'quantity B',
    xlim = c(-3, 7), ylim = c(-1, 1))

plot(x = a, y = b,
    type = 'b',
    lwd = 3, lty = 2, col = 2,
    xlab = 'quantity A', ylab = 'quantity B',
    xlim = c(0.5, 6.5), ylim = c(0, 0.5))
```

Note that the sum of `b` values is 1:

```{r}
sum(b)
```

so `b` could be a discrete probability distribution for the quantity `a`.

### A custom plot function

If the quantity `a` is non-numeric, for instance a sequence of character strings, then we must first somehow convert it to numbers in order to use `plot()`, otherwise we get an error.

In these notes we use the custom function `flexiplot()`, which takes care of such conversions internally. We can load it from the file [`tplotfunctions.R`](https://github.com/pglpm/ADA511/blob/master/code/tplotfunctions.R), which you should have already downloaded:

```{r}
source('tplotfunctions.R')
```

Consider a quantity `animal` that could be one of six possible animals, and  the distribution of probability over them, assigned to a variable `prob`. With `flexiplot()` we can plot the probability distribution as follows:

```{r}
animal <- c('cat', 'dog', 'chicken', 'cow', 'pig', 'horse')
prob <- c(0.05, 0.3, 0.4, 0.2, 0.03, 0.02)

flexiplot(x = animal, y = prob, type = 'b', ylim = c(0, NA))
```

Note how the animal names appear in the x-axis, in the order specified. The range specification `ylim = c(0, NA)` (not available for `plot()`) says that the lower range should be $0$, and the upper range should be the maximum available among the y-axis values.
\

Suppose we need to plot two different probability distributions (or two different sets of y-values more generally), stored in the variables `prob1` and `prob2`, for the same x-values, as in the last plot of [§@sec-discr-prob-distr]. We can do this by binding them together into an array with two columns with the [`cbind()`](https://stat.ethz.ch/R-manual/R-patched/library/base/html/cbind.html) function, and then giving this array as the `y =` argument:

```{r}
prob1 <- c(0.05, 0.3, 0.4, 0.2, 0.03, 0.02)
prob2 <- c(0.2, 0.6, 0.05, 0.04, 0.01, 0.1)

flexiplot(x = animal, y = cbind(prob1, prob2),
    type = 'b', ylim = c(0, NA),
    ylab = 'two probability distributions')
```

We could also issue two separate `flexiplot()` commands, giving the argument `add = TRUE` to the second. But in this case we must make sure to give the correct y-range already in the first plot, and we must also explicitly use different colours `col =` and line types `lty =`. Check for instance what would happen for the case above:

```{r}
## Plot for prob1
flexiplot(x = animal, y = prob1,
    type = 'b', ylim = c(0, NA),
    ylab = 'two probability distributions')

## Plot for prob2
flexiplot(x = animal, y = prob2,
    type = 'b', col = 2, lty = 2,
    add = TRUE)
```

You see that the curve in the second plot was partly cut off, because the first plot adapted the y-range to the first curve only.

\

## Plotting probability densities in R {#sec-R-plotting-densities}

If $X$ is a continuous quantity, we know the mathematical formula for a probability density over its domain, then the density can be plotted as pairs of values, as we did above. We need to generate many values of $X$ in the range of interest, and calculate the probability density for each from the mathematical formula.

Suppose for instance that $X$ has all real numbers as its domain, and probability density $\p(X\|I)$ given by a [Gaussian, or "normal", distribution](https://mathworld.wolfram.com/NormalDistribution.html) with mean $5$ and standard deviation $3$. Its mathematical formula is

$$
\p(X\mo x \| I) = \frac{1}{\sqrt{2\pi\cdot 3^2}}\,
\exp\biggl[
-\frac{(x - 5)^2}{2\cdot 3^2}
\biggr]\,.
$$

We'd like to visualize this probability density between $X\mo -7$ and $X\mo 10$. Then we proceed as follows:

- Generate a large number of values, say hundreds, for $X$ from $-5$ to $10$. The number of values to generate depends on the resolution at which the final plot will be shown.
    
    In this example we'll generate 257 values using the function [`seq()`](https://stat.ethz.ch/R-manual/R-patched/library/base/html/seq.html) with argument `length =`, and store them in the variable `x`.

- Calculate the probability density for each $X$ value generated. In R this is often easy, as we can give the whole sequence of numbers to a mathematical function.
    
    In R, the formula for the Gaussian distribution is given by the function [`dnorm()`](https://stat.ethz.ch/R-manual/R-patched/library/stats/html/Normal.html) with arguments `mean =` and `sd =`.

- Plot the pairs of values generated.

```{r}
x <- seq(from = -7, to = 10, length = 257)

p <- dnorm(x, mean = 5, sd = 3)

flexiplot(x = x, y = p, ylim = c(0, NA), ylab = 'p(x | I)')
```

If we need to display more densities in the same plot we can proceed as described in the previous section.

R has built-in functions for many common probability densities; they have all names of the form `d...()`, take a look at the [index](https://stat.ethz.ch/R-manual/R-patched/library/stats/html/00Index.html). Packages like [**extraDistr**](https://cran.r-project.org/package=extraDistr) provide even more densities.


\

## 1D scatter plots in R {#sec-R-1Dscatter}

What if we want to represent a probability density as a scatter plot, as was done in [§@sec-represent-dens]?

R has the built-in function [`rug()`](https://stat.ethz.ch/R-manual/R-patched/library/graphics/html/rug.html)
